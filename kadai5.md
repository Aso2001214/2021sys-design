@startuml
ユーザー->webサーバー:商品を選択し確定
webサーバー->DBサーバー:商品の情報照会
DBサーバー->DBサーバー:商品の情報と一致する商品を検出
DBサーバー->webサーバー:一致した商品情報
activate ユーザー
alt 商品の在庫あり
webサーバー->ユーザー:購入情報の提示
else 在庫なし
webサーバー->ユーザー:完売と表示
end 

opt 購入確定
ユーザー->webサーバー:購入方法選択&住所情報
  alt カード決済
  ユーザー->webサーバー:SSL対応決済ページでクレジットカード情報を入力
  webサーバー->決済サーバー:決済サーバーを経由し各決済機関に決済データを送信
  決済サーバー->webサーバー:決済結果返答
  alt 決済可
  webサーバー->ユーザー:決済が終了したと表示
  else 決済不可
  webサーバー->ユーザー:承認エラーが起きたと表示
  end
  end
  webサーバー->ユーザー:商品到着予定を表示
  end
deactivate ユーザー
@enduml
